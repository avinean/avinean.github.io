!function(){"use strict";function e(e){if(Array.isArray(e))return e;if(e instanceof Map){var n=[];return e.forEach((function(e,t){n.push([t,e])})),n}if(e instanceof Set||e instanceof NodeList){var r=[];return(e.forEach||t).call(e,(function(e){r.push(e)})),r}return[]}function t(e,t){t=t||window;for(var n=0;n<this.length;n+=1)e.call(t,this[n],this)}function n(t){var n=new Map;if(t)for(var r=0,o=e(t);r<o.length;r++){var i=o[r],a=i[0],c=i[1];n.set(a,c)}function s(){var e=[];return n.forEach((function(t,n){e.push([n,t])})),e}return n.keys=function(){return s().map((function(e){return e[0]}))},n.values=function(){return s().map((function(e){return e[1]}))},n.entries=function(){return s()},n}function r(e){return(e||[]).slice(-1)[0]}(function(e,t){void 0===t&&(t="");var n=this.event&&this.event.type,r="unload"===n||"beforeunload"===n,o=new XMLHttpRequest;o.open("POST",e,!r),o.withCredentials=!0,o.setRequestHeader("Accept","*/*"),"string"==typeof t?(o.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),o.responseType="text"):t instanceof Blob&&t.type&&o.setRequestHeader("Content-Type",t.type);try{o.send(t)}catch(e){return!1}return!0}).bind(window);var o=Date.now(),i=function(){function e(){this.marks=n(),this.measures=n(),console.info("[Evolv] Using Performance API shim")}return e.prototype.getEntriesByName=function(e,t){return t&&"mark"!==t||!this.marks.has(e)?t&&"measure"!==t||!this.measures.has(e)?[]:this.measures.get(e):this.marks.get(e)},e.prototype.mark=function(e){this.marks.has(e)||this.marks.set(e,[]),this.marks.get(e).push({name:e,entryType:"mark",startTime:Date.now(),duration:0,toJSON:function(){}})},e.prototype.measure=function(e,t,n){this.measures.has(e)||this.measures.set(e,[]);var i=r(this.marks.get(t)),a=r(this.marks.get(n)),c=i?i.startTime:o,s=a?a.startTime:Date.now();this.measures.get(e).push({name:e,entryType:"measure",startTime:c,duration:s-c,toJSON:function(){}})},e}(),a=window.performance,c=a.getEntriesByName,s=a.mark,u=a.measure,d=c&&s&&u?window.performance:new i,l=function(e,t,n){void 0===e&&(e=null),void 0===t&&(t=null),this.onFulfilled=e,this.onRejected=t,this.promise=n},f=setTimeout;function h(){}var v=function(){function e(e){this.handled=!1,this.state=0,this.deferreds=[],p(e,this)}return e.prototype.then=function(t,n){var r=new e(h);return m(this,new l(t,n,r)),r},e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this.constructor;return this.then((function(n){return t.resolve(e()).then((function(){return n}))}),(function(n){return t.resolve(e()).then((function(){return t.reject(n)}))}))},e.resolve=function(t){return new e((function(e){e(t)}))},e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(){throw new Error("Not implemented")},e.all=function(t){return new e((function(e,n){var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var o=r.length;function i(t,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void c.call(a,(function(e){i(t,e)}),n)}r[t]=a,0==--o&&e(r)}catch(e){n(e)}}for(var a=0;a<r.length;a++)i(a,r[a])}))},e.immediateFn=function(e){f(e,0)},e._unhandledRejection=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},e}();function p(e,t){var n=!1;try{e((function(e){n||(n=!0,g(t,e))}),(function(e){n||(n=!0,w(t,e))}))}catch(e){if(n)return;n=!0,w(t,e)}}function m(e,t){for(;3===e.state;)e=e.value;0!==e.state?(e.handled=!0,v.immediateFn((function(){var n=1===e.state?t.onFulfilled:t.onRejected;if(n){var r;try{r=n(e.value)}catch(e){return void w(t.promise,e)}g(t.promise,r)}else(1===e.state?g:w)(t.promise,e.value)}))):e.deferreds.push(t)}function g(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof v)return e.state=3,e.value=t,void y(e);if("function"==typeof n)return void p(n.bind(t),e)}e.state=1,e.value=t,y(e)}catch(t){w(e,t)}}function w(e,t){e.state=2,e.value=t,y(e)}function y(e){2===e.state&&0===e.deferreds.length&&v.immediateFn((function(){e.handled||v._unhandledRejection(e.value)}));for(var t=0;t<e.deferreds.length;t++)m(e,e.deferreds[t]);e.deferreds=[]}window.evolvShims=window.evolvShims||{},window.evolvShims.performance=d,window.evolvShims.PromiseShim=v}(),function(e){"use strict";var t=!1;t||([function(){for(var e=document.scripts,t=0;t<e.length;t+=1){var n=e[t].dataset;"evolvWebsite"in n&&!("evolvEnvironment"in n)&&(n.evolvEnvironment=n.evolvWebsite)}}].forEach((function(e){return e()})),t=!0);var n,r=function(){function t(){var t=this;this.promise=new e.PromiseShim((function(e,n){t.resolve=e,t.reject=n}))}return t.prototype.then=function(e,t){return this.promise.then(e,t)},t.prototype.catch=function(e){return this.promise.catch(e)},t.prototype.finally=function(e){return this.promise.finally(e)},t}(),o=window.document,i=window.localStorage,a=window.location,c=window.sessionStorage,s=window.addEventListener.bind(window),u=window.removeEventListener.bind(window),d=window.clearTimeout.bind(window),l=window.setTimeout.bind(window),f=(o.createElement.bind(o),o.querySelector.bind(o)),h=(o.querySelectorAll.bind(o),window.decodeURIComponent),v=new(function(){function e(e){this.selector=e,this.element=f(e),this.element||console.warn("Emitter cannot be attached because selector does not match any element")}return e.prototype.emit=function(e,t){var n;this.element&&("function"==typeof CustomEvent?n=new CustomEvent(e,{detail:t}):(n=document.createEvent("CustomEvent")).initCustomEvent(e,!1,!1,t),this.element.dispatchEvent(n))},e.prototype.on=function(e,t){this.element&&this.element.addEventListener(e,(function(e){t(e.detail)}))},e.prototype.off=function(e,t){this.element&&this.element.removeEventListener(e,(function(e){t(e.detail)}))},e}())("script[data-evolv-environment]");!function(t){function n(e){return void 0===e&&(e="default"),t.runtime.then((function(t){return t.emitEvent(e)}))}t.version="1.20.2",t.isReady=!1,t.editor=new r,t.runtime=new r,t.scout=new r,t.ready=e.PromiseShim.all([t.runtime,t.scout]).then((function(e){return t.isReady=!0,e})),t.trigger=function(e){if(!t.isReady)throw new Error("The Evolv runtime is not yet ready.");n(e)},t.triggerAsync=n,t.off=function(e,t){return v.off(e,t),window.evolv},t.on=function(e,t){return v.on(e,t),window.evolv},t.scripts={}}(n||(n={})),window.evolv=window.evolv||n,window.ascend=window.ascend||n,function(e,t){void 0===t&&(t="");var n=this.event&&this.event.type,r="unload"===n||"beforeunload"===n,o=new XMLHttpRequest;o.open("POST",e,!r),o.withCredentials=!0,o.setRequestHeader("Accept","*/*"),"string"==typeof t?(o.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),o.responseType="text"):t instanceof Blob&&t.type&&o.setRequestHeader("Content-Type",t.type);try{o.send(t)}catch(e){return!1}return!0}.bind(window);var p=function(){function e(e){void 0===e&&(e=""),this.entries=[],e=e.replace(/^\?/,"")||"",this.parseToEntries(e)}return e.prototype.append=function(e,t){this.entries.push([e,t])},e.prototype.has=function(e){return this.entries.some((function(t){return t[0]===e}))},e.prototype.get=function(e){return this.getAll(e)[0]},e.prototype.getAll=function(e){return this.entries.filter((function(t){return t[0]===e})).map((function(e){return e[1]}))},e.prototype.forEach=function(e,t){for(var n=0,r=this.entries;n<r.length;n++){var o=r[n],i=o[0],a=o[1];e.call(t,a,i,this)}},e.prototype.toString=function(){var e=this;return this.entries.reduce((function(t,n){var r=n[0],o=n[1];return t.concat(e.encode(r)+"="+e.encode(o))}),[]).join("&")},e.prototype.parseToEntries=function(e){for(var t=e.split("&"),n=0;n<t.length;n++){var r=t[n],o=r.indexOf("=");-1<o?this.append(this.decode(r.slice(0,o)),this.decode(r.slice(o+1))):r&&this.append(this.decode(r),"")}},e.prototype.decode=function(e){return e.replace(/[ +]/g,"%20").replace(/(%[a-f0-9]{2})+/gi,(function(e){return decodeURIComponent(e)}))},e.prototype.encode=function(e){var t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'\(\)~]|%20|%00/g,(function(e){return t[e]}))},e}(),m=function(e,t){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function g(e,t){function n(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var w=function(){return(w=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},y=function(e){function t(){return e.call(this,"Configuration not found. The Evolv script tag must specify the 'data-evolv-environment' attribute")||this}return g(t,e),t}(Error),b=function(e){function t(){return e.call(this,"Deadlock detected that may be caused by this lock not being released.")||this}return g(t,e),t}(Error),k=function(){this.expires=1e4,this.instanceId="",this.pollingRate=500},E=function(){function e(e,t){var n=this;this.key=e,this.deferred=null,this.timer=null,this._lock=null,this.onStorageChanged=function(e){e.storageArea===i&&e.key===n.key&&null===e.newValue&&n.acquire()},this.onLockCommandeered=function(e){e.storageArea===i&&e.key===n.key&&null!==e.newValue&&(u("storage",n.onLockCommandeered),n._lock=null,n.deferred&&n.deferred.reject(new b))},this.options=w({},new k,t),s("unload",(function(){n.release()}))}return Object.defineProperty(e.prototype,"hasLock",{get:function(){return!!this.lock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lock",{get:function(){return this._lock},set:function(e){this._lock=e,e?i.setItem(this.key,JSON.stringify(e)):i.removeItem(this.key)},enumerable:!0,configurable:!0}),e.prototype.acquire=function(){var e=this,t=this.options,n=t.expires,o=t.pollingRate;this.deferred||(this.deferred=new r),d(this.timer);var i=this.getGlobalLock(),a=Date.now();return!i||i.expires<a?(u("storage",this.onStorageChanged),this.lock={expires:Date.now()+n,instanceId:this.options.instanceId},s("storage",this.onLockCommandeered),this.deferred.resolve()):o>0&&(s("storage",this.onStorageChanged),this.timer=l((function(){return e.acquire()}),o)),this.deferred},e.prototype.release=function(){u("storage",this.onLockCommandeered),u("storage",this.onStorageChanged),d(this.timer),this.deferred=null,this.hasLock&&(this.lock=null)},e.prototype.getGlobalLock=function(){try{var e=i.getItem(this.key)||"";return JSON.parse(e)}catch(e){return null}},e}();function S(){return Math.round(1e8*Math.random())+"_"+Date.now()}Object.defineProperty(function(e){this.value=e}.prototype,"current",{get:function(){return this.value},set:function(e){this.value=e},enumerable:!0,configurable:!0});var P,x={environmentId:"",autoLoad:!0,reconcile:"leave",apiUrl:"https://participants.evolv.ai",sdkUrl:"https://media.evolv.ai/releases/1.20.2/runtime.min.js",editorUrl:"https://media.evolv.ai/releases/1.20.2/editor.js",cookieDomains:[""],editorAdapterUrl:"https://app.ascend.ai/adapter.js"},j=63072e6,I=/^(.+?)=(.*)$/;function O(){return(o.cookie?o.cookie.split("; "):[]).reduce((function(e,t){var n=I.exec(t);if(!n)return e;var r,o=h(n[1]),i=h(n[2]);try{r=JSON.parse(i)}catch(e){r=i.replace(/^"(.*)"$/,"$1")}return e.set(o,r),e}),new Map)}function _(e,t,n){void 0===n&&(n={});var r=n.domain?"; domain="+n.domain:"",i="; path="+(n.path||"/"),a="";if(n.millis){var c=new Date;c.setTime(c.getTime()+n.millis),a="; expires="+c.toUTCString()}o.cookie=e+"="+t+a+r+i}function A(e){return c.getItem(e)}function C(e,t){c.setItem(e,t)}!function(e){e.CandidateIds="evolv:cids",e.DeviceId="evolv:did",e.SessionId="evolv:sid",e.UserId="evolv:uid"}(P||(P={}));var R=function(e){this.message="Halting further execution: "+e};function T(t){return new e.PromiseShim((function(e,n){var r=document.createElement("script");r.defer=!0,r.src=t,r.onload=e,r.onerror=n,document.head.appendChild(r)}))}function U(t,n){return n=n||t,t="Proxy"in window&&navigator.sendBeacon?n:t,document.body||(r=window.navigator.userAgent).indexOf("MSIE ")>0||r.indexOf("Trident/")>0||r.indexOf("Edge/")>0||!document.querySelector("[src $= '"+t+"']")?T(t):e.PromiseShim.resolve();var r}function L(){return"true"===A("evolv:interactiveMode")}var F="evolv-previewid=([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\\.json)",q="evolv-previewcid=([0-9a-f]+(?:(?:%3a|:)[0-9a-f]+)+)",D="evolvCandidateToken=(([0-9]+)_([0-9]+)_([0-9a-z]+))",M=[{shouldActivate:function(){return a.hash.indexOf("_ascend_editor=")>=0||null!==A("_ascend_editor")},activate:function(t){return function(){if(a.hash){var e=new p(a.hash.substring(1)).get("_ascend_editor");e&&(C("_ascend_editor",atob(e)),a.href=a.href.replace(new RegExp("[#&]_ascend_editor=[^&]*"),""))}}(),function(t){return A("_ascend_editor")?T(t.editorAdapterUrl):e.PromiseShim.resolve()}(t).catch((function(){return e.PromiseShim.reject(new Error("Editor Mode: Error loading adapter"))}))}},{shouldActivate:function(){return L()},activate:function(){return e.PromiseShim.resolve()}},{shouldActivate:function(){return a.search.indexOf("ascend-editor-bridge=true")>=0},activate:function(){return T("https://media.ascend.ai/bridge/editor_bridge.js"),e.PromiseShim.reject(new R("Popout mode"))}},{shouldActivate:function(){return new RegExp(F).test(a.hash)},activate:function(t,n){var r=a.hash.match(new RegExp(F));return r&&(C("evolv-previewid",r[1]),a.href=a.href.replace(new RegExp("#?&?evolv-previewid=([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\\.json)"),""),n.debug("Live Preview mode activated")),e.PromiseShim.reject(new R("Live preview mode"))}},{shouldActivate:function(){return new RegExp(q,"i").test(a.hash)},activate:function(t,n){var r=new RegExp(q,"i"),o=a.hash.match(r);if(o){var i=h(o[1]),c=new RegExp("#?&?evolv-previewcid=([0-9a-f]+(?:(?:%3a|:)[0-9a-f]+)+)","i");C("evolv-previewcid",i),a.href=a.href.replace(c,""),n.debug("Preview Candidate mode activated")}return e.PromiseShim.reject(new R("Preview candidate mode"))}},{shouldActivate:function(e){var t=a.hash.match(new RegExp(D));return t&&e.environmentId===t[4]},activate:function(t,n){var r=a.hash.match(new RegExp(D));return r&&(C("evolvCandidateToken",r[1]),a.href=a.href.replace(new RegExp("#?&?evolvCandidateToken=(([0-9]+)_([0-9]+)_([0-9a-z]+))"),""),n.debug("QA mode activated")),e.PromiseShim.reject(new R("QA mode"))}}],H=new(function(){function t(t){var n=this;this.logger=function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r="[Evolv]"+t.map((function(e){return"["+e+"]"})).join("");return{debug:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.debug.apply(console,[r,e].concat(t))},error:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.error.apply(console,[r,e].concat(t))},info:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.info.apply(console,[r,e].concat(t))},log:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.log.apply(console,[r,e].concat(t))},warn:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.warn.apply(console,[r,e].concat(t))},clone:function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return e.apply(void 0,t.concat(n))}}}("Scout"),this.started=!1,this._instanceId=S(),this.config=t,this._tracker=function(e){void 0===e&&(e=[]);for(var t=O(),n=t.get(P.UserId)||S(),r=t.get(P.DeviceId)||S(),o=t.get(P.SessionId)||S(),i=0,a=e;i<a.length;i++){var c=a[i];_(P.UserId,n,{domain:c,millis:j}),_(P.DeviceId,r,{domain:c,millis:j}),_(P.SessionId,o,{domain:c,millis:2592e6})}return{uid:n,sid:o,did:r,previewId:A("evolv-previewid"),previewCid:A("evolv-previewcid"),candidateToken:A("evolvCandidateToken")}}(t.cookieDomains),function(){if(window.evolvPreload&&window.evolvPreload.listeners){var e=window.evolvPreload.listeners;Object.keys(e).forEach((function(t){v.on(t,e[t])}))}}(),s("readystatechange",(function(){var t=o.readyState;n.logger.debug("Ready State: "+t),e.performance.mark("ready-state-"+t)}))}return Object.defineProperty(t.prototype,"instanceId",{get:function(){return this._instanceId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tracker",{get:function(){return this._tracker},enumerable:!0,configurable:!0}),t.prototype.start=function(){var t=this;return this.started?e.PromiseShim.resolve():M.reduce((function(e,n){return n.shouldActivate(t.config)?e.then((function(){return n.activate(t.config,t.logger)})):e}),e.PromiseShim.resolve()).then((function(){return"localStorage"in window&&"sessionStorage"in window&&navigator.cookieEnabled?(t.started=!0,v.emit("initialize",{config:t.config}),t.logger.debug("Started (instance: "+t.instanceId+")"),t.logger.debug("Ready State: "+o.readyState),e.PromiseShim.all([t.loadRuntime()].concat(!t.config.autoLoad||A("_ascend_editor")||L()?[]:[t.loadExecutionPlan()]))):(t.logger.debug("Evolv will not launch"),e.PromiseShim.resolve())})).catch((function(e){e instanceof R?t.logger.info(e.message):t.logger.error(e)}))},t.prototype.loadRuntime=function(){var e=this;return U(this.config.sdkUrl,this.config.sdkUrl.replace(/(\.min)?\.js$/,"$1.mjs")).catch((function(){e.logger.warn("Runtime failed to load")}))},t.prototype.loadExecutionPlan=function(){return this.logger.info("Reconciliation has been disabled"),this.retrieveExecutionPlan().then((function(){return e.PromiseShim.resolve()}))},t.prototype.retrieveExecutionPlan=function(){var t=this,n=new E("evolv:mutex",{instanceId:this.instanceId});return e.PromiseShim.resolve().then((function(){return n.acquire().then((function(){return U(t.getExecutionPlanUrl("browser-cache"))})).catch((function(){t.logger.warn("Execution plan failed to load")})).finally((function(){n.release()}))})).then((function(){e.performance.mark("execution-plan-retrieved"),t.logger.debug("Execution plan was retrieved successfully")}))},t.prototype.reconcile=function(){var t=this;if(null===i.getItem("evolv:planVersion"))return e.PromiseShim.resolve();var n=S();return U(this.getExecutionPlanUrl(n)).catch((function(){t.logger.debug("Error occurred during reconciliation")}))},t.prototype.getExecutionPlanUrl=function(e){var t=this.config.environmentId,n=new p,r=this.getCidLists(),o=r.confirmed,i=r.excluded;return n.append("version",e),n.append("uid",this.tracker.uid),n.append("sid",this.tracker.sid),n.append("did",this.tracker.did),n.append("cids",o),n.append("excl",i),this.tracker.previewId&&n.append("previewid",this.tracker.previewId),this.tracker.previewCid&&n.append("previewcid",this.tracker.previewCid),this.tracker.candidateToken&&(t=this.tracker.candidateToken),this.config.apiUrl+"/v1/"+t+"/execution-plans?"+n},t.prototype.getCidLists=function(){var e,t=(e=P.CandidateIds,O().get(e)||null);if(!t)return{confirmed:"",excluded:""};var n=function(e){var t=e.l,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(e,["l"]);if(!e)return n;for(var r=0,o=Object.keys(n);r<o.length;r++){var i=o[r];n[i]=n[i].map((function(e){return t[e]}))}return n}(t),r=n.cf,o=n.f.filter((function(e){return e.startsWith("*:")})).map((function(e){return e.replace(/^\*:/,"")}));return{confirmed:r.join(","),excluded:o.join(",")}},t}())(function(){for(var e=o.scripts,t=null,n=0;n<e.length;n+=1){var r=e[n].dataset;if("evolvEnvironment"in r){t=r;break}}if(!t)throw new y;var i,a,c={environmentId:t.evolvEnvironment,autoLoad:(i=t.evolvAutoLoad,"false"!==i&&("true"===i||i)),apiUrl:t.evolvApiUrl,sdkUrl:t.evolvSdkUrl,editorUrl:t.evolvEditorUrl,cookieDomains:(t.evolvCookieDomains||"").split(/,\s*/)};return Object.freeze(w({},x,(a=c,Object.keys(a).reduce((function(e,t){return void 0!==a[t]&&(e[t]=a[t]),e}),{}))))}());H.start(),window.evolv.scout.resolve(H)}(window.evolvShims);
//# sourceMappingURL=scout.min.js.map
